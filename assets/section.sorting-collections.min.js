!function(t){"use strict";theme.SortingCollections=function(){function e(e){this.$container=t(e),this.namespace=".sorting-collections",this.onLoad()}return e.prototype=t.extend({},Section.prototype,e.prototype,{onLoad:function(){var e=this.$container.find("[data-sorting-collections-control]"),o=this.$container.find("[data-sorting-collections-ajax] [data-collection]"),n=this.$container.find("[data-sorting-collections-items]"),i=this.$container.find("[data-sorting-collections-more]"),a=null;function s(o,s,r){a&&a.abort(),s&&theme.Loader.set(n);var c=o.attr("data-collection"),l=n.attr("data-limit"),d=n.attr("data-grid");a=t.ajax({type:"GET",url:theme.routes.root_url+"collections/"+c,cache:!1,data:{view:"sorting",count_limit:l,grid_classes:encodeURIComponent(d)},dataType:"html",success:function(t){var c;if(n.html(t),n[0].hasAttribute("data-is-design-mode")&&((c=n.children()).addClass(d),c.length>l))for(var h=l;h<c.length;h++)c.eq(h).remove();theme.ImagesLazyLoad.update(),theme.ProductCurrency.update(),theme.ProductCountdown.init(n.find(".js-countdown").removeClass("js-countdown--lazy")),theme.ProductReview.update(),e.find("a").removeClass("active"),o.addClass("active"),i&&i.text(theme.strings.homepage.sorting_collections.button_more_products.replace("{{ collection }}",o.text())).attr("href",o.attr("href")),s&&theme.Loader.unset(n),a=null,r&&r()}})}this.$control=e,o.length&&s(o.first(),!1,(function(){i.length&&i.removeClass("invisible")})),e.on("click","a",(function(e){var o=t(this);return o.hasClass("active")||s(o,!0),e.preventDefault(),!1}))},onUnload:function(){this.$container.off(this.namespace),this.$control.off()}}),e}(),t((function(){theme.sections.register("sorting-collections",theme.SortingCollections)}))}(jQueryTheme);